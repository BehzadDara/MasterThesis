\فصل{پیاده‌سازی و ارزیابی}

برای تولید سلسله فعالیت جعلی به نحوی که از دید سکو قابل تمایز با سلسله فعالیت واقعی نباشد؛ نیاز به پیاده‌سازی دقیق مدل مطرح شده در بخش \ref{chapter:c44} و ارزیابی کامل بر اساس مدل تهدید گفته شده در بخش \ref{chapter:c42} است. در این فصل به توصیف کلی پیاده‌سازی نرم‌افزار و ارزیابی کامل آن با نمونه داده‌های متنوع بر اساس مدل تهدید سکوی صادق ولی کنجکاو خواهیم پرداخت.

\section{پیاده‌سازی}

در این بخش به بررسی پیاده‌سازی راهکار پیشنهادی این پژوهش طبق الگوریتم ارائه شده در بخش \ref{chapter:c443} می‌پردازیم.

\subsection{معماری و ساختار پیاده‌سازی}

راهکار پیشنهادی این پژوهش به صورت یک پروژه \lr{Web API} است که به زبان \پاورق{‌سی‌شارپ}{C\#} توسعه یافته است که با استفاده از \پاورق{‌معماری سه لایه}{Three Layered Architecture} طراحی شده است که شامل لایه‌های \lr{API}، \پاورق{‌دامنه}{Domain} و \پاورق{‌زیرساخت}{Infrastructure} می‌باشد. لایه \lr{API} به عنوان رابط کاربری عمل می‌کند و درخواست‌ها را از کاربران دریافت کرده و به لایه دامنه ارسال می‌کند. لایه دامنه مسئولیت مدیریت منطق کسب‌وکار و پردازش داده‌ها را بر عهده دارد. لایه زیرساخت نیز ارتباط با پایگاه داده و منابع خارجی را فراهم می‌سازد.

برای مدیریت داده‌ها در این راهکار پیشنهادی این پژوهش از \lr{SQL Server} استفاده شده است. این پایگاه داده به عنوان \پاورق{‌سیستم مدیریت پایگاه داده}{Database Management System (DBMS)} عمل می‌کند و داده‌های پروژه را به صورت ساختاریافته ذخیره و مدیریت می‌نماید، که این امر باعث افزایش کارایی و سرعت دسترسی به داده‌ها می‌شود.

\subsection{کد برنامه}

عملکرد اصلی راهکار پیشنهادی این پژوهش در کلاس \lr{CoreService} انجام شده است که بخش‌های اصلی آن را به صورت دقیق تعریف می‌کنیم.

عملکرد اصلی راهکار پیشنهادی این پژوهش در کلاس \lr{CoreService} انجام شده است که بخش‌های اصلی آن را به صورت دقیق تعریف می‌کنیم. کد مربوط به این بخش‌ها در آدرس \پاورق{\lr{GitHub}}{https://github.com/BehzadDara/FakeEventGenerator} قرار داده شده است.



\begin{itemize}
\item \textbf{\lr{GenerateFakeActivities}}: در این تابع با توجه به شرایط کنونی خانه هوشمند، به صورت عقبگرد حرکت کرده تا به نقطه شروع تولید سلسله فعالیت جعلی برسیم (ممکن است شرایط کنونی ورود به خانه باشد و نیازی به حرکت عقبگرد نداشته باشیم).
\item \textbf{\lr{CheckConditions}}: در این تابع شرایط انجام فعالیتی که می‌خواهیم به سلسله فعالیت جعلی اضافه شود را بررسی می‌کنیم تا با توجه به حالت خانه هوشمند، فعالیت قابل انجام باشد.
\item \textbf{\lr{GenerateRecursively}}: در این تابع تولید سلسله فعالیت جعلی انجام می‌شود و در هر مرحله با توجه به فعالیت‌های بعدی ممکن، یک مرحله جلو می‌رویم تا به نقطه‌ توقف برسیم.
\item \textbf{\lr{SetResults}}: پس از تولید هر فعالیت جعلی، تغییر حالت خانه هوشمند که نتیجه آن فعالیت است را اعمال می‌کنیم تا حالت خانه هوشمند از دید سکو، حالتی منطقی و درست باشد.
\item \textbf{\lr{FindNextActivity}}: در این تابع از بین فعالیت ممکن قابل انجام پس از فعالیت جعلی تولید شده، یکی را به صورت تصادفی (با احتمال انجام آن بر اساس قوانین انجمنی) انتخاب می‌کنیم.
\item \textbf{\lr{GenerateFinalResult}}: در این تابع که پس از اتمام تابع \lr{GenerateRecursively} اجرا می‌شود، هر فعالیت به داده‌های ارسالی حسگرها نگاشت می‌شود تا به سکو ارسال شوند.
\end{itemize}

\section{ارزیابی}

برای ارزیابی این پژوهش فرض شده است که سکو با استفاده از یک دسته‌بند به شناسایی فعالیت‌های کاربر با استفاده از اطلاعات حسگرهای خانه هوشمند می‌پردازد. در این ارزیابی میزان گمراه‌سازی سکو با تولید رخدادهای جعلی بر اساس مجموعه داده‌ای از فعالیت‌های کاربر توسط ابزار پیاده‌سازی شده اندازه‌گیری شده است. بدین منظور ابتدا هستی‌شناسی متناسب با مجموعه داده تعریف شده و پس از تولید سلسله فعالیت جعلی، ترکیب آن با سلسله فعالیت واقعی به دسته‌بند داده شده و میزان کاهش دقت آن به عنوان معیار ارزیابی در نظر گرفته شده است. این معیار نشان‌دهنده‌ قدرت راهکار پیشنهادی در گمراه‌سازی سکو است.

\subsection{مجموعه دادگان}

مجموعه داده مورد استفاده در این پژوهش مجموعه داده \lr{Orange4Home} \cite{xyz6} است که شامل تقریباً ۱۸۰ ساعت فعالیت‌های روزمره یک فرد است که به مدت ۴ هفته متوالی در روزهای کاری انجام شده است. این مجموعه داده شامل داده‌های ۲۳۶ حسگر ناهمگن است که به‌طور یکپارچه در سراسر یک آپارتمان پخش شده‌اند و ۲۰ دسته فعالیت که توسط فرد به‌طور دقیق در محل برچسب‌گذاری شده‌اند، و در مجموع ۴۹۳ نمونه از فعالیت‌ها را شامل می‌شود. این ویژگی‌ها، \lr{Orange4Home} را به یک مجموعه داده مناسب برای ارزیابی الگوریتم‌های شناسایی فعالیت، ارزیابی الگوریتم‌های پیش‌بینی فعالیت و سایر مسائل پژوهشی مرتبط با الگوریتم‌ها و خانه‌های هوشمند تبدیل می‌کند.

خانه هوشمند استفاده شده در مجموعه داده \lr{Orange4Home} شامل بخش‌های ورودی، آشپزخانه، سرویس بهداشتی، پذیرایی و راه پله در طبقه همکف و راه پله، راهرو، دفتر کار، حمام و اتاق خواب در طبقه اول است که این نقشه در اشکال \ref{fig:fO4H1} و  \ref{fig:fO4H2} قابل مشاهده است.

\begin{figure}[H]
\centerline{\includegraphics[width=0.8\textwidth]{figs/fO4H1.png}}
\caption[نقشه خانه مجموعه داده \lr{Orange4Home}، طبقه همکف]{نقشه خانه مجموعه داده \lr{Orange4Home}، طبقه همکف \cite{xyz6}}
\label{fig:fO4H1}
\end{figure}

\begin{figure}[H]
\centerline{\includegraphics[width=0.8\textwidth]{figs/fO4H2.png}}
\caption[نقشه خانه مجموعه داده \lr{Orange4Home}، طبقه اول]{نقشه خانه مجموعه داده \lr{Orange4Home}، طبقه اول \cite{xyz6}}
\label{fig:fO4H2}
\end{figure}

در هر بخش از این خانه هوشمند، حسگرهایی با انواع \پاورق{‌دودویی}{Binary}، \پاورق{‌عدد صحیح}{Integer}، \پاورق{‌عددی}{Real number} و \پاورق{‌دسته‌ای}{Categorical} وجود دارد که تعداد این حسگرها به تفکیک بخش‌های مختلف خانه هوشمند، در شکل \ref{tab:tO4H1} قابل مشاهده است. تعدادی از حسگرها در مجموعه داده \lr{Orange4Home} سراسری و برای کل خانه است که این مقادیر رابطه مستقیم با فعالیت فعلی کاربر و داده حسگرهای مربوط به فعالیت‌ها ندارند، در نتیجه در مجموعه داده و تولید سلسله فعالیت جعلی از این داده‌ها صرف نظر شده است و به جای 236 حسگر، در این پژوهش از 196 حسگر (با حذف حسگرهای سراسری) استفاده شده است.

\begin{table} [htp]
 \centering
 \caption{حسگرهای هر بخش خانه هوشمند}
 \label{tab:tO4H1}
 \begin{adjustbox}{width=0.8\textwidth}
\begin{tabular}{|l|c|c|c|c|c|}
\hline
\textbf{محل} & \textbf{دودویی} & \textbf{عدد صحیح} & \textbf{عددی} & \textbf{دسته‌ای} & \textbf{مجموع} \\ \hline
ورودی       & 3               & 1                & 2                    & 3                    & 9             \\ \hline
آشپزخانه        & 13              & 21               & 18                   & 0                    & 52            \\ \hline
پذیرایی    & 16              & 6                & 8                    & 7                    & 37            \\ \hline
سرویس بهداشتی         & 3               & 1                & 1                    & 0                    & 5             \\ \hline
راه پله      & 3               & 0                & 0                    & 0                    & 3             \\ \hline
راهرو        & 9               & 0                & 1                    & 0                    & 10            \\ \hline
حمام       & 9               & 6                & 8                    & 3                    & 26            \\ \hline
دفتر کار         & 9               & 3                & 3                    & 5                    & 20            \\ \hline
اتاق خواب        & 17              & 4                & 6                    & 7                    & 34            \\ \hline
سراسری         & 1               & 13               & 20                   & 6                    & 40            \\ \hline
\textbf{مجموع} & \textbf{83}     & \textbf{55}      & \textbf{67}          & \textbf{31}          & \textbf{236}  \\ \hline
\end{tabular}
\end{adjustbox}
\end{table}

در این مجموعه داده فعالیت‌های برچسب‌گذاری شده شامل داده‌های حسگرها می‌باشند و تمامی اطلاعات ارسالی از حسگرها بین شروع و پایان برچسب یک فعالیت است. هر فعالیت برچسب‌گذاری شده متعلق به یک بخش خانه است که در ادامه لیستی از این فعالیت‌ها ذکر شده است:

\begin{itemize}
\item \textbf{ورودی}: ورود، خروج
\item \textbf{آشپزخانه}: آماده‌سازی، آشپزی، شستن ظروف
\item \textbf{پذیرایی}: خوردن، تلویزیون دیدن، کار با رایانه
\item \textbf{سرویس بهداشتی}: استفاده از سرویس بهداشتی
\item \textbf{راه پله}: بالا رفتن، پایین آمدن
\item \textbf{حمام}: استفاده از روشویی، استفاده از سرویس بهداشتی، حمام کردن
\item \textbf{دفتر کار}: کار با رایانه، تلویزیون دیدن
\item \textbf{اتاق خواب}: لباس عوض کردن، کتاب خواندن، خوابیدن
\item \textbf{تمامی بخش‌ها}: تمیز کاری
\end{itemize}

همانطور که گفته شد، داده‌های حسگرها بین شروع و پایان یک فعالیت برچسب‌گذاری شده ارسال می‌شوند. در مجموعه داده \lr{Orange4Home}، یک فایل \lr{csv} قرار دارد که داده حسگرها با را در خود دارد. این داده‌ها شامل زمان دقیق ارسال داده توسط حسگر، نام حسگر و مقدار ارسال شده توسط آن حسگر است که نمونه داده‌ موجود در مجموعه داده در شکل \ref{fig:fO4H3} قابل مشاهده است. در این شکل شروع فعالیت ورود به خانه است که در همان دقیقه ورود و باز کردن درب، داده‌های مربوط به صدای محیط، روشن شدن چراغ و دیگر عوامل محیطی به صورت خودکار به سکو ارسال می‌گردد.

\begin{figure}[H]
\centerline{\includegraphics[width=0.8\textwidth]{figs/fO4H3.png}}
\caption{نمونه داده ارسالی از حسگرها در مجموعه داده \lr{Orange4Home}}
\label{fig:fO4H3}
\end{figure}

\subsection{هستی‌شناسی}‌

برای استخراج هستی‌شناسی از مجموعه داده \lr{Orange4Home}، ابتدا مجاورت بخش‌های مختلف خانه بر اساس نقشه تعریف شده است. سپس نسخه‌ای فیلتر شده از مجموعه داده که فقط دارای فعالیت‌های برچسب‌گذاری شده است را تهیه کردیم که بخشی از آن در شکل \ref{fig:fO4H4} قابل مشاهده است. از این مجموعه داده برای محاسبه احتمال رخداد یک فعالیت پس از دیگری استفاده شده است تا بتوانیم سلسله فعالیت جعلی غیر قابل تمایز با استفاده از قوانین انجمنی تولید کنیم (جزئیات استفاده از احتمالات در قوانین انجمنی، در بخش \ref{chapter:c442} آورده شده است). 

\begin{figure}[H]
\centerline{\includegraphics[width=0.8\textwidth]{figs/fO4H4.png}}
\caption{بخشی از مجموعه داده فیلتر شده \lr{Orange4Home} که فقط فعالیت‌ها در آن هستند.}
\label{fig:fO4H4}
\end{figure}

سپس، داده حسگرها مربوط به هر فعالیت برچسب‌گذاری شده را استخراج می‌کنیم و پس از تولید سلسله فعالیت جعلی بر اساس هستی‌شناسی و  قوانین انجمنی فعالیت‌ها، به جای هر فعالیت یکی از سلسله داده حسگرهای موجود در مجموعه داده برای آن فعالیت را به صورت تصادفی انتخاب و به سکو ارسال می‌کنیم. سلسله داده‌های ارسالی حسگرها به ازای هر فعالیت در هستی‌شناسی آن فعالیت و ارتباط با حسگرها قرار داده شده است.

\subsection{دسته‌بند}‌

همان‌طور که بیان شد، برای ارزیابی کیفیت سلسله فعالیت‌ جعلی تولید شده توسط ابزار پیشنهادی، میزان افت دقت تشخیص فعالیت توسط یک دسته‌بند اندازه‌گیری می‌شود. برای این منظور از دسته‌بند استفاده شده در کار پژوهشی اقوامی و همکاران \cite{x3341} به عنوان معیار ارزیابی استفاده شده است که با دقت ۹۸ درصد فعالیت متناظر با رخدادهای مجموعه‌داده \lr{Orange4Home} را تشخیص می‌دهد. این دسته‌بند یک شبکه عصبی پیچشی است که معماری آن در شکل \ref{fig:fO4H5} آورده شده است. ورودی این دسته‌بند یک بردار شامل ۱۹۶ مقدار است که هر کدام نشانگر یک حسگر در خانه است و مقدار آن بیانگر آخرین رخداد گزارش شده از آن حسگر است. این مقادیر با پیش‌پردازش مجموعه داده محاسبه شده است و برای پر کردن مقادیر ناموجود در هر لحظه، از مقدار قبل از آن و یا در صورت عدم وجود، از مقدار بعد از آن استفاده شده است. بدین ترتیب دسته‌بند با داشتن یک وضعیت از تمام حسگرها، فعالیت کاربر در آن زمان را تشخیص می‌دهد. این دسته‌بند برای گزارش دقت تشخیص فعالیت از روش \پاورق{‌اعتبارسنجی متقابل ۴-تا}{fold cross validation 4} استفاده کرده است که یعنی، از مجموعه داده \lr{Orange4Home} سه هفته را برای آموزش و یک هفته را برای ارزیابی استفاده کرده و این کار را چهار بار تکرار کرده است. در هر ارزیابی، یکی از هفته‌ها برای ارزیابی و سه هفته دیگر برای آموزش استفاده شده و خروجی هر چهار ارزیابی مقدار میانگین 98 درصد را داشته‌ است.

\begin{figure}[H]
\centerline{\includegraphics[width=0.5\textwidth]{figs/fO4H5.png}}
\caption{معماری دسته‌بند استفاده شده}
\label{fig:fO4H5}
\end{figure}

\subsection{نتایج}‌

دسته‌بند مورد ارزیابی، فعالیت‌های مجموعه داده \lr{Orange4Home} را با دقت 98 درصد تشخیص می‌دهد. برای ارزیابی راهکار ارائه شده این پژوهش دو عامل دقت تشخیص فعالیت جعلی به عنوان یک فعالیت کامل به صورت مستقل و دقت تشخیص فعالیت واقعی در زمان دریافت فعالیت واقعی و جعلی به صورت در هم تنیده شده را بررسی می‌کنیم. علاوه بر دقت تشیخص، معیار \پاورق{‌صحت}{Precision}، \پاورق{‌بازخوانی}{Recall} و \پاورق{‌امتیاز \lr{F1}}{F-score} را برای تمامی فعالیت‌ها در هر دو حالت ذکر شده اندازه‌گیری کرده‌ایم. 

معیار صحت، بیانگر تشخیص صحیح در مواردی است که دسته‌بند فعالیتی را به طور دقیق اعلام کرده است که با فرمول زیر قابل اندازه‌گیری است:

\begin{equation}
\text{Precision} = \frac{\text{True Positives (TP)}}{\text{True Positives (TP)} + \text{False Positives (FP)}}
\end{equation}

معیار بازخوانی، بیانگر تشخیص صحیح در مواردی است که دسته‌بند باید فعالیت را به طور دقیق اعلام می‌کرد که با فرمول زیر قابل اندازه‌گیری است:

\begin{equation}
\text{Recall} = \frac{\text{True Positives (TP)}}{\text{True Positives (TP)} + \text{False Negatives (FN)}}
\end{equation}

معیار امتیاز \lr{F1}، بیانگر \پاورق{‌میانگین هارمونیک}{Harmonic mean} صحت و بازخوانی است که یک معیار واحد را اعلام می‌کند که با فرمول زیر قابل اندازه‌گیری است:

\begin{equation}
\text{F-score} = 2 \times \frac{\text{Precision} \times \text{Recall}}{\text{Precision} + \text{Recall}}
\end{equation}

 در صورتی که دسته‌بند سلسله فعالیت جعلی را به صورت مجزا دریافت کند، بالا بودن دقت تشخیص آن به عنوان یک فعالیت مستقل و کامل به معنی نزدیکی سلسله فعالیت جعلی به واقعیت است که دقت دسته‌بند از 98 درصد به 88 درصد رسیده که به معنی عملکرد قابل قبول از راهکار ارائه شده در پژوهش است. برای ارزیابی در این بخش به دسته‌بند که با مجموعه داده \lr{Orange4Home} آموزش دیده شده است، چندین بار سلسله فعالیت جعلی تولید شده برای یک یا دو روز کامل را دادیم و دقت تشخیص آن را اندازه‌گیری کردیم. دقت تشخیص فعالیت به تفکیک نوع فعالیت در شکل \ref{fig:fnatijeh1} قابل مشاهده است. در این بخش از ارزیابی معیار صحت برابر 89 درصد، معیار بازخوانی برابر 90 درصد و امتیاز \lr{F1} برابر 89.49 درصد است که این معیارها به تفکیک نوع فعالیت در شکل \ref{fig:fnatijeh11} قابل مشاهده است.

\begin{figure}[H]
\centerline{\includegraphics[width=0.8\textwidth]{figs/fnatijeh1.png}}
\caption{دقت تشخیص هر نوع فعالیت جعلی به عنوان یک فعالیت مستقل در مقایسه با دقت اولیه}
\label{fig:fnatijeh1}
\end{figure}

\begin{figure}[H]
\centerline{\includegraphics[width=0.8\textwidth]{figs/fnatijeh11.png}}
\caption{معیارهای صحت، بازخوانی و امتیاز \lr{F1} به تفکیک نوع فعالیت برای تشخیص هر نوع فعالیت جعلی به عنوان یک فعالیت مستقل}
\label{fig:fnatijeh11}
\end{figure}

در صورتی که دسته‌بند سلسله فعالیت جعلی و واقعی را همزمان و به صورت در هم تنیده شده دریافت کند، پایین بودن دقت تشخیص آن به عنوان یک فعالیت به معنی عدم تمایز سلسله فعالیت جعلی از واقعی است که دقت دسته‌بند در این حالت از 98 درصد به 43 کاهش پیدا کرده که اثباتی بر عدم توانایی دسته‌بند در تمییز فعالیت جعلی و واقعی از یکدیگر است. برای ارزیابی در این بخش به دسته‌بند که با مجموعه داده \lr{Orange4Home} آموزش دیده شده است، چندین بار به سلسله فعالیت واقعی، سلسله فعالیت جعلی تزریق کرده و آن سلسله فعالیت جعلی را با برچسب فعالیت‌های واقعی برای یک یا دو روز کامل را دادیم و دقت تشخیص آن را اندازه‌گیری کردیم. دسته‌بند در این حالت برچسب فعالیت واقعی را به همراه داده واقعی آن فعالیت و داده جعلی فعالیتی دیگر دریافت می‌کند. دقت به دست آمده از دسته‌بند به تفکیک نوع فعالیت در شکل \ref{fig:fnatijeh2} قابل مشاهده است. در این بخش از ارزیابی معیار صحت برابر 41 درصد، معیار بازخوانی برابر 37 درصد و امتیاز \lr{F1} برابر 38.89 درصد است که این معیارها به تفکیک نوع فعالیت در شکل \ref{fig:fnatijeh21} قابل مشاهده است.

\begin{figure}[H]
\centerline{\includegraphics[width=0.8\textwidth]{figs/fnatijeh2.png}}
\caption{دقت تشخیص هر نوع فعالیت در ترکیب فعالیت جعلی و واقعی و تمایز آن در مقایسه با دقت اولیه}
\label{fig:fnatijeh2}
\end{figure}

\begin{figure}[H]
\centerline{\includegraphics[width=0.8\textwidth]{figs/fnatijeh21.png}}
\caption{معیارهای صحت، بازخوانی و امتیاز \lr{F1} به تفکیک نوع فعالیت برای تشخیص هر نوع فعالیت در ترکیب فعالیت جعلی و واقعی}
\label{fig:fnatijeh21}
\end{figure}
